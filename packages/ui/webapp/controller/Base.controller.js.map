{"version":3,"file":"Base.controller.js","names":["_fragments","Base","Controller","onInit","todoModel","getOwnerComponent","getModel","todoModelData","getData","getMainView","getView","viewController","onExit","openFragment","config","viewName","name","indexOf","split","substr","lastIndexOf","getViewName","pop","viewPath","join","controllerPath","replace","id","getId","newController","create","error","console","log","newFragment","Fragment","load","controller","fragment","addDependent","closedPromise","Promise","resolve","reject","onBeforeShow","data","popoverSource","openBy","open"],"sources":["../../src/controller/Base.controller.ts"],"sourcesContent":["import Dialog from \"sap/m/Dialog\";\nimport Popover from \"sap/m/Popover\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport View from \"sap/ui/core/mvc/View\";\nimport TodoModel, { todoModelData } from \"../models/TodoModel\";\nimport DialogController from \"./Dialog.controller\";\n\nexport type frag = {\n\tcontroller: DialogController;\n\tfragment: Fragment;\n};\ntype frags = Record<string, frag>;\nlet _fragments: frags = {};\n/**\n * @namespace hacking.away.sampleapp.controller\n */\nexport default class Base extends Controller {\n\tprotected todoModelData: todoModelData;\n\tprotected todoModel: TodoModel;\n\tprotected viewController: Controller;\n\n\tpublic onInit(): void {\n\t\tthis.todoModel = this.getOwnerComponent().getModel() as TodoModel;\n\t\tthis.todoModelData = this.todoModel.getData() as todoModelData;\n\t}\n\n\tpublic getMainView(): View {\n\t\treturn this.getView() || this.viewController.getView();\n\t}\n\tpublic onExit(): void {\n\t\t_fragments = {};\n\t}\n\n\tpublic async openFragment(config: { name: string; data?: unknown; popoverSource?: Popover }): Promise<unknown> {\n\t\tlet viewName: string[];\n\t\tif (config.name.indexOf(\".\") > 0) {\n\t\t\t//full path\n\t\t\tviewName = config.name.split(\".\");\n\t\t\tconfig.name = config.name.substr(config.name.lastIndexOf(\".\") + 1);\n\t\t} else {\n\t\t\t//current folder\n\t\t\tviewName = this.getMainView().getViewName().split(\".\");\n\t\t}\n\t\tviewName.pop();\n\t\tconst viewPath = viewName.join(\".\") + \".\",\n\t\t\tcontrollerPath = viewPath.replace(\"view\", \"controller\"),\n\t\t\tid = this.getMainView().getId() + \"--\" + config.name;\n\t\tif (!_fragments[id]) {\n\t\t\tlet newController: Controller;\n\t\t\ttry {\n\t\t\t\tnewController = (await Controller.create({\n\t\t\t\t\tname: controllerPath + config.name\n\t\t\t\t})) as Controller;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(\"Dialog without controller. Just continue with the current controller for the dialog\");\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tnewController = this;\n\t\t\t}\n\t\t\tconst newFragment = (await Fragment.load({\n\t\t\t\tid: id,\n\t\t\t\tname: viewPath + config.name,\n\t\t\t\tcontroller: newController\n\t\t\t})) as unknown as Fragment;\n\t\t\t_fragments[id] = { controller: newController as DialogController, fragment: newFragment };\n\t\t\tthis.getMainView().addDependent(_fragments[id].fragment as unknown as UI5Element);\n\t\t}\n\t\tconst closedPromise = new Promise((resolve, reject) => {\n\t\t\tif (_fragments[id].controller && (_fragments[id].controller as Controller) !== this) {\n\t\t\t\tif (\"onBeforeShow\" in _fragments[id].controller) {\n\t\t\t\t\t_fragments[id].controller.onBeforeShow(this, _fragments[id], resolve, config.data, config.popoverSource);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (config.popoverSource) {\n\t\t\t(_fragments[id].fragment as unknown as Popover).openBy(config.popoverSource, false);\n\t\t} else {\n\t\t\t(_fragments[id].fragment as Dialog).open();\n\t\t}\n\t\treturn closedPromise; //_fragments[id].fragment;\n\t}\n}\n"],"mappings":"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"}